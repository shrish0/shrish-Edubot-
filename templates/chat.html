{% load static %}
<!DOCTYPE html>
<html lang="zxx" class="no-js">

<head>
  <!-- Mobile Specific Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Favicon -->
  <link rel="shortcut icon" href="img/fav.png" />
  <!-- Author Meta -->
  <meta name="author" content="colorlib" />
  <!-- Meta Description -->
  <meta name="description" content="" />
  <!-- Meta Keyword -->
  <meta name="keywords" content="" />
  <!-- meta character set -->
  <meta charset="UTF-8" />
  <!-- Site Title -->
  <title>Edu Free</title>

  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:900|Roboto:400,400i,500,700" rel="stylesheet" />
  <!--
      CSS
      =============================================
    -->
  <link rel="stylesheet" href="{% static 'css/linearicons.css' %}" />
  <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}" />
  <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}" />
  <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}" />
  <link rel="stylesheet" href="{% static 'css/owl.carousel.css' %}" />
  <link rel="stylesheet" href="{% static 'css/nice-select.css' %}">
  <link rel="stylesheet" href="{% static 'css/hexagons.min.css' %}" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/themify-icons/0.1.2/css/themify-icons.css" />
  <link rel="stylesheet" href="{% static 'css/main.css' %}" />
  <link rel="stylesheet" href="{% static 'css/allclass.css' %}" />
  <link rel="stylesheet" href="{% static 'css/class.css' %}" />
  <link rel="stylesheet" href="{% static 'css/new_self.css' %}" />

  <style>
   
    .message.sender {
        text-align: right;
        align-items: end;
        color: #00ff00; /* Change color for sender */
        
    }
    .message.receiver {
        text-align: left;
        color: #ff0000; /* Change color for receiver */
    }



    /* Additional CSS styles for chat interface */

    /* Message container styling */
    #message-container {
        overflow-y: auto; /* Enable vertical scrolling */
        height: 80vh;/* Limit maximum height to prevent overflow */
        padding: 10px;
        position: relative;
        border-radius: 10px; /* Add border radius */
        margin-top: 10px 0px;
    }

    /* Message styling */
    .message {
        margin: 5px 0; /* Add margin between messages */
        padding: 8px 12px; /* Add padding to messages */
        border-radius: 15px; /* Add border radius to messages */ 
        word-wrap: break-word;
    }

    /* Sender message styling */
    .message.sender {
        background-color: #9d5af2cf; /* Set background color for sender messages */
        color: #fff; /* Set text color for sender messages */
        align-self: flex-end; /* Align sender messages to the right */
        width: 50%;
        margin-left: 47%;
        margin-right: 3%;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    /* Receiver message styling */
    .message.receiver {
        background-color: #eee; /* Set background color for receiver messages */
        color: #333; /* Set text color for receiver messages */
        align-self: flex-start; /* Align receiver messages to the left */
        width: 50%;
        margin-left: 3%;
        margin-top: 10px;
        font-size:18px;
        margin-bottom: 10px;
    }

    /* Form container styling */
    .form-container {
        background-color: #fff; /* Set background color */
    }
    #message-form{
        width: 97%;
        margin: 0px 8px;
    }
    /* Message input field styling */
    #message-form input[type="text"] {
        width: 80%; /* Set width of input field */
        padding: 8px; /* Add padding */
        border: none; /* Remove border */
        border-radius: 5px; /* Add border radius */
    }

    /* Send button styling */
    #message-form button {

        border-radius: 5px; /* Add border radius */
        background-color: ##007bff; /* Set background color */
        color: #fff; /* Set text color */
        cursor: default; /* Change cursor to pointer on hover */
        transition: background-color 0.3s; /* Add transition effect for background color */
    }

    /* Send button hover effect */
    #message-form button:hover {
        background-color: #007B48; /* Darken background color on hover */
    }



    .form-container {
        display: flex; /* Add flex display */
        justify-content: flex-end; /* Align form items with space between them */
        align-items: center; /* Center align form items vertically */

        background-color: #fff; /* Set background color */
        border-radius: 10px; /* Add border radius */
        /* Add space between message container and form container */
        height: 10%;
        
    /* Adjust max-width as needed */
    }



    form {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        margin-top: 0px; /* Add margin-top for spacing */
    }

    input[type="text"] {
        flex-grow: 1; /* Allow input to grow and take up remaining space */
        padding: 10px; /* Add padding for better appearance */
        border-radius: 4px;
        border: 1px solid #ccc;
        align-items: end;
    }
    button[type="submit"] {
        padding: 8px 20px; /* Add padding for better appearance */
        border-radius: 25px;
        background-color: #007bff;
        color: #fff;
        cursor: default ;
        border: none;
        margin-left: 10px; /* Add margin-left for spacing */
    }
    button[type="submit"]:hover {
        background-color: #0056b3;
    }

    
    /* CSS for bottom tab */
    .bottom_tab {
        /* Enlarge the h1 */
        margin-bottom: 0; /* Remove default margin */
        position: fixed;
        bottom: 0;
        background: black;
            
        width: 100%;
        box-shadow: #FCF55F 2px 2px 2px;
        border: solid black 3px;
    }

    /* Hide scrollbar UI */
    #message-container::-webkit-scrollbar {
        width: 0;  /* Remove scrollbar space */
        background: transparent;  /* Optional: make scrollbar track transparent */
    }

    .chat{
        color:gold;
    }

    /* Optional: hide scrollbar track */
    #message-container::-webkit-scrollbar-track {
        background: transparent;
    }

    /* Customize scrollbar thumb */
    #message-container::-webkit-scrollbar-thumb {
        background-color: transparent;
    }



    @media(max-width:576px)
    {
        .message.sender
        {
            padding:18px;
            width:80vw;
            margin-left: 18%;
        }
        .message.receiver
        {
            width:80vw;
        }
        p{
            font-size:12px;
            line-height: 12px;
        }
        .message{
            padding :0px 8px;
        }
    }


    #sticky-header{
        background: linear-gradient(to right, #273746, #5C758B); 
    }

    .default-header1{
        background-color: black;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 9;
    }

    .message.receiver{
        padding: 12px;
        background-color: #9334F3;
        color: white;
        align-self: flex-start;
        width: 83%;
        margin-left: 3%;
        margin-top: 10px;
        justify-content: center;
        font-size: 20px;
        margin-bottom: 10px;
        font-size:18px;
    }
    .name_up{
        font-weight: 900;
        color:white;
    }
</style>
</head>

<body>
  <!-- ================ Start Header Area ================= -->
  <header class="default-header1">
    <nav class="navbar navbar-expand-lg  navbar-light">
      <div class="container">
        <a class="navbar-brand" href="http://{{DJANGO_SERVER_IP}}/index.html">
          <img src="{% static 'img/logo.png' %}" alt="" />
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="lnr lnr-menu"></span>
        </button>

        <div class="collapse navbar-collapse justify-content-end align-items-center" id="navbarSupportedContent">
          <ul class="navbar-nav">
            <li><a href="http://{{DJANGO_SERVER_IP}}/index.html">Home</a></li>
            <li><a href="http://{{DJANGO_SERVER_IP}}/about.html">About</a></li>
            <li><a href="http://{{DJANGO_SERVER_IP}}/courses.html">Courses</a></li>
            <!-- Dropdown -->
            
            <li class="dropdown">
              <a class="dropdown-toggle" href="#" data-toggle="dropdown">
                More
              </a>
              <div class="dropdown-menu">
                <a class="dropdown-item" href="http://{{DJANGO_SERVER_IP}}/FaQ.html">Faq</a>
                <a class="dropdown-item" href="http://{{DJANGO_SERVER_IP}}/chat">Community</a>
              </div>
            </li>
            <li><a href="http://{{DJANGO_SERVER_IP}}/contacts.html">Contacts</a></li>
          </ul>
        </div>
      </div>
    </nav>
   
  </header>
  
  <div class="message-container w3-container " id="message-container" style="height: 83vh;">
    {% for message in messages %}
        {% if message.sender.username == user.username %}
            <p class="message sender">
              <span class="name_up" >
                {{ message.sender.username }} ({{ message.timestamp }}):</span>
                <br>  <br> {{ message.content }}</p>
        {% else %}
            <p class="message receiver">
                <span class="name_up" >
                {{ message.sender.username }}
             ({{ message.timestamp }}): </span>
             <br> <br> {{ message.content }}</p>
        {% endif %}
    {% endfor %}
</div>

<div class="form-container bottom_tab">
    <form id="message-form" method="post" action="{% url 'send_message' group_number %}">
        {% csrf_token %}
        <input type="text" name="content" placeholder="Type your message here" required>
        <button type="submit" z-index:1;>Send</button>
    </form>
</div>



    

<script src="{% static 'js/vendor/jquery-2.2.4.min.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
crossorigin="anonymous"></script>
<script src="{% static 'js/vendor/bootstrap.min.js' %}"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBhOdIF3Y9382fqJYt5I_sswSrEw5eihAA"></script>
<script src="{% static 'js/jquery.ajaxchimp.min.js' %}"></script>
<script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
<script src="{% static 'js/parallax.min.js' %}"></script>
<script src="{% static 'js/owl.carousel.min.js' %}"></script>
<script src="{% static 'js/jquery.sticky.js' %}"></script>
<script src="{% static 'js/hexagons.min.js' %}"></script>
<script src="{% static 'js/jquery.counterup.min.js' %}"></script>
<script src="{% static 'js/waypoints.min.js' %}"></script>
<script src="{% static 'js/jquery.nice-select.min.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>

<script>
    // Function to fetch new messages from the backend using AJAX
    function fetchNewMessages() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', `{% url 'get_messages' group_number %}`, true);
      xhr.onreadystatechange = function() {
          if (xhr.readyState === XMLHttpRequest.DONE) {
              if (xhr.status === 200) {
                  // Data successfully fetched
                  // Replace the existing messages with the new ones
                  document.getElementById('message-container').innerHTML = xhr.responseText;
              } else {
                  console.error('Error fetching new messages:', xhr.statusText);
              }
          }
      };
      xhr.send();
  }

  // Fetch new messages every 30 seconds
  setInterval(fetchNewMessages, 300); // Adjust the interval as needed

  
 </script>
</body>

</html>